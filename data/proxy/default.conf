# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name pan.<BASE_DOMAIN> mattermost.<BASE_DOMAIN> pihole.<BASE_DOMAIN> cyberchef.<BASE_DOMAIN> mkdocs.<BASE_DOMAIN>;
    return 301 https://$host$request_uri;
}

# Pan Subdomain Configuration
server {
    listen 443 ssl;
    server_name pan.<BASE_DOMAIN>;

    ssl_certificate /etc/ssl/certs/nginx/pan.<BASE_DOMAIN>.crt;
    ssl_certificate_key /etc/ssl/certs/nginx/pan.<BASE_DOMAIN>.key;

    location / {
        include /etc/nginx/includes/proxy.conf;
        proxy_pass http://pan:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Enable WebSocket support
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
    }
}

# Mattermost Subdomain Configuration
server {
    listen 443 ssl;
    server_name mattermost.<BASE_DOMAIN>;

    ssl_certificate /etc/ssl/certs/nginx/mattermost.<BASE_DOMAIN>.crt;
    ssl_certificate_key /etc/ssl/certs/nginx/mattermost.<BASE_DOMAIN>.key;

    location / {
        proxy_pass http://mattermost:8065/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Enable WebSocket support
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
    }
}
# PiHole Subdomain Configuration (Including /admin)
server {
    listen 443 ssl;
    server_name pihole.<BASE_DOMAIN>;

    ssl_certificate /etc/ssl/certs/nginx/pihole.<BASE_DOMAIN>.crt;
    ssl_certificate_key /etc/ssl/certs/nginx/pihole.<BASE_DOMAIN>.key;

    location / {
        proxy_pass http://pihole:80/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Enable WebSocket support if needed
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
    }
}
# CyberChef
server {
    listen 443 ssl;
    server_name cyberchef.<BASE_DOMAIN>;

    ssl_certificate /etc/ssl/certs/nginx/cyberchef.<BASE_DOMAIN>.crt;
    ssl_certificate_key /etc/ssl/certs/nginx/cyberchef.<BASE_DOMAIN>.key;

    location / {
        proxy_pass http://cyberchef:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Enable WebSocket support if needed
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
    }
}
# GoStatic
server {
    listen 443 ssl;
    server_name gostatic.<BASE_DOMAIN>;

    ssl_certificate /etc/ssl/certs/nginx/gostatic.<BASE_DOMAIN>.crt;
    ssl_certificate_key /etc/ssl/certs/nginx/gostatic.<BASE_DOMAIN>.key;

    location / {
        proxy_pass http://gostatic:8043/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Enable WebSocket support if needed
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
    }
}
# MkDocs
server {
    listen 443 ssl;
    server_name mkdocs.<BASE_DOMAIN>;

    ssl_certificate /etc/ssl/certs/nginx/mkdocs.<BASE_DOMAIN>.crt;
    ssl_certificate_key /etc/ssl/certs/nginx/mkdocs.<BASE_DOMAIN>.key;

    location / {
        proxy_pass http://mkdocs:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Enable WebSocket support if needed
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
    }
}
